<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wedding Album - Bounce Motion</title>
  <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      background: url('https://res.cloudinary.com/dbpxjgghy/image/upload/v1753978920/ChatGPT_Image_Jul_31_2025_07_16_17_PM_sothpf.png') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Varela Round', sans-serif;
    }

    .moving-img {
      position: absolute;
      object-fit: cover;
      width: 15vw;
      height: 15vw;
      pointer-events: none;
      opacity: 0;
      transition: opacity 1.2s ease-in-out;
    }

    .moving-img.loaded {
      opacity: 1;
    }

    .shape-circle {
      clip-path: circle(50%);
    }

    .shape-ellipse {
      clip-path: ellipse(50% 35% at 50% 50%);
    }

    .shape-star {
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
    }

 .shape-heart {
  width: 200px;
  height: 200px;
  background: red;
  clip-path: polygon(
    50% 80%,
    20% 60%,
    0% 35%,
    25% 10%,
    50% 25%,
    75% 10%,
    100% 35%,
    80% 60%
  );
}


    .shape-diamond {
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
    }

    .shape-triangle {
      clip-path: polygon(0% 0%, 100% 0%, 50% 100%);
    }

    .shape-rounded-rect {
      clip-path: inset(0 round 20% 20%);
    }

    .spinning-wrapper {
      animation-name: spin;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .floating-blessing {
      position: absolute;
      font-size: 1.8vh;
      color: #1E90FF;
      padding: 8px 12px;
      z-index: 100;
      text-align: center;
      text-shadow: 0 0 8px #0D47A1;
      max-width: 20vw;
      transform: rotate(-5deg);
      pointer-events: none;
      font-weight: 600;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      user-select: none;
      transition: all 0.3s ease;
    }
  </style>
</head>
<body>
  <script>
    const imageSettings = [
      { dx: 1.5, dy: 1.1, spin: false, spinSpeed: 0, scale: 2.2 },
      { dx: -1.6, dy: 0.9, spin: true, spinSpeed: 24, scale: 1.8 },
      { dx: 1.3, dy: -1.4, spin: false, spinSpeed: 0, scale: 2.3 },
      { dx: -1.2, dy: 1.3, spin: false, spinSpeed: 0, scale: 2.6 },
      { dx: 1.4, dy: -1.2, spin: false, spinSpeed: 0, scale: 2.0 },
      { dx: -1.3, dy: 1.6, spin: false, spinSpeed: 0, scale: 2.1 },
      { dx: -1.5, dy: 1.2, spin: true, spinSpeed: 22, scale: 1.9 }
    ];

    const shapeClasses = [
      'shape-circle',
      'shape-ellipse',
      'shape-star',
      'shape-heart',
      'shape-diamond',
      'shape-triangle',
      'shape-rounded-rect'
    ];

    const blessingPositions = [
      { top: '5vh', left: '5vw', rotate: '-5deg' },
      { top: '10vh', right: '5vw', rotate: '6deg' },
      { bottom: '10vh', left: '7vw', rotate: '3deg' },
      { bottom: '5vh', right: '10vw', rotate: '-4deg' }
    ];

    const images = [];

    function createImage(url, settings, shapeClass) {
      const wrapper = document.createElement('div');
      wrapper.style.position = 'absolute';

      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const imgWidth = 15 * settings.scale;
      const imgPxWidth = (vw * imgWidth) / 100;
      const imgPxHeight = imgPxWidth * 0.75;

      const maxX = vw - imgPxWidth;
      const maxY = vh - imgPxHeight;
      const startX = Math.random() * maxX;
      const startY = Math.random() * maxY;

      wrapper.style.left = `${startX}px`;
      wrapper.style.top = `${startY}px`;

      const img = new Image();
      img.src = url;
      img.className = `moving-img ${shapeClass}`;
      img.style.transform = `scale(${settings.scale})`;
      img.onload = () => img.classList.add('loaded');

      const container = document.createElement('div');
      if (settings.spin) {
        container.className = 'spinning-wrapper';
        container.style.animationDuration = settings.spinSpeed + 's';
      }
      container.appendChild(img);
      wrapper.appendChild(container);
      document.body.appendChild(wrapper);

      const slowdownFactor = 0.8;
      const adjustedDx = (settings.dx / settings.scale) * slowdownFactor;
      const adjustedDy = (settings.dy / settings.scale) * slowdownFactor;

      images.push({ el: wrapper, dx: adjustedDx, dy: adjustedDy });
    }

    function showBlessings(blessings) {
      blessings.slice(0, blessingPositions.length).forEach((text, i) => {
        const pos = blessingPositions[i];
        const el = document.createElement('div');
        el.className = 'floating-blessing';
        el.textContent = text;

        Object.assign(el.style, pos);
        el.style.transform = `rotate(${pos.rotate})`;

        document.body.appendChild(el);
      });
    }

    function animate() {
      const w = window.innerWidth;
      const h = window.innerHeight;

      images.forEach((img, i) => {
        const el = img.el;
        const imgEl = el.querySelector('img');
        const scaleMatch = imgEl.style.transform.match(/scale\(([\d.]+)\)/);
        const scale = scaleMatch ? parseFloat(scaleMatch[1]) : 1;

        const width = el.offsetWidth * scale;
        const height = el.offsetHeight * scale;
        let x = parseFloat(el.style.left);
        let y = parseFloat(el.style.top);

        const nextX = x + img.dx;
        const nextY = y + img.dy;

        if (nextX < 0 || nextX + width > w) img.dx *= -1;
        if (nextY < 0 || nextY + height > h) img.dy *= -1;

        for (let j = 0; j < images.length; j++) {
          if (i !== j) {
            const other = images[j];
            const otherEl = other.el;
            const otherImg = otherEl.querySelector('img');
            const otherScaleMatch = otherImg.style.transform.match(/scale\(([\d.]+)\)/);
            const otherScale = otherScaleMatch ? parseFloat(otherScaleMatch[1]) : 1;

            const ox = parseFloat(otherEl.style.left);
            const oy = parseFloat(otherEl.style.top);
            const ow = otherEl.offsetWidth * otherScale;
            const oh = otherEl.offsetHeight * otherScale;

            const overlap =
              nextX < ox + ow &&
              nextX + width > ox &&
              nextY < oy + oh &&
              nextY + height > oy;

            if (overlap) {
              img.dx *= -1;
              img.dy *= -1;
              break;
            }
          }
        }

        el.style.left = (x + img.dx) + 'px';
        el.style.top  = (y + img.dy) + 'px';
      });

      requestAnimationFrame(animate);
    }

    window.addEventListener('message', event => {
      const data = event.data.images || [];
      document.querySelectorAll('.moving-img, .floating-blessing, .spinning-wrapper').forEach(el => {
        if (el.parentNode) el.parentNode.remove();
      });

      images.length = 0;

      const urls = data.map(obj => obj.url);
      const rawBlessings = data.map(obj => obj.blessing);
      const blessings = rawBlessings.filter(b => b?.trim());

      urls.slice(0, 7).forEach((url, i) => {
        const shape = shapeClasses[i % shapeClasses.length];
        createImage(url, imageSettings[i], shape);
      });

      showBlessings(blessings);
      animate();
    });
  </script>
</body>
</html>
