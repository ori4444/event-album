<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wedding Album - Bounce Motion</title>
  <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      background: url('https://res.cloudinary.com/dbpxjgghy/image/upload/v1753978920/ChatGPT_Image_Jul_31_2025_07_16_17_PM_sothpf.png') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Varela Round', sans-serif;
    }

    .moving-img {
      position: absolute;
      object-fit: contain;
      border-radius: 1vh;
      width: 15vw;
      height: auto;
      pointer-events: none;
      border: 0.25vh solid #b0b7c3;
      box-shadow: 0 0 1vh rgba(176, 183, 195, 0.35);
      background-color: #fdfdfd;
    }

    .spinning-wrapper {
      animation-name: spin;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .floating-blessing {
      position: absolute;
      font-size: 1.8vh;
      color: red;
      z-index: 100;
      text-align: center;
      text-shadow: 1px 1px 2px white;
      max-width: 20vw;
      transform: rotate(-5deg);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <script>
    const imageSettings = [
      { dx: 1.5, dy: 1.1, spin: false, spinSpeed: 0, scale: 2.2 },
      { dx: -1.6, dy: 0.9, spin: true, spinSpeed: 24, scale: 1.8 },
      { dx: 1.3, dy: -1.4, spin: false, spinSpeed: 0, scale: 2.3 },
      { dx: -1.2, dy: 1.3, spin: false, spinSpeed: 0, scale: 2.6 },
      { dx: 1.4, dy: -1.2, spin: false, spinSpeed: 0, scale: 2.0 },
      { dx: -1.3, dy: 1.6, spin: false, spinSpeed: 0, scale: 2.1 },
      { dx: -1.5, dy: 1.2, spin: true, spinSpeed: 22, scale: 1.9 }
    ];

    // הגדרה של 4 מיקומים בלבד
    const blessingPositions = [
      { top: '6vh', left: '5vw', rotate: '-4deg' },
      { top: '6vh', right: '5vw', rotate: '5deg' },
      { bottom: '6vh', left: '5vw', rotate: '3deg' },
      { bottom: '6vh', right: '5vw', rotate: '-3deg' }
    ];

    const images = [];

    function createImage(url, settings) {
      const wrapper = document.createElement('div');
      wrapper.style.position = 'absolute';

      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const imgWidth = 15 * settings.scale;
      const imgPxWidth = (vw * imgWidth) / 100;
      const imgPxHeight = imgPxWidth * 0.75;

      const maxX = vw - imgPxWidth;
      const maxY = vh - imgPxHeight;
      const startX = Math.random() * maxX;
      const startY = Math.random() * maxY;

      wrapper.style.left = `${startX}px`;
      wrapper.style.top = `${startY}px`;

      const img = new Image();
      img.src = url;
      img.className = 'moving-img';
      img.style.transform = `scale(${settings.scale})`;

      const container = document.createElement('div');
      if (settings.spin) {
        container.className = 'spinning-wrapper';
        container.style.animationDuration = settings.spinSpeed + 's';
      }
      container.appendChild(img);
      wrapper.appendChild(container);
      document.body.appendChild(wrapper);

      const slowdownFactor = 0.8;
      const adjustedDx = (settings.dx / settings.scale) * slowdownFactor;
      const adjustedDy = (settings.dy / settings.scale) * slowdownFactor;

      images.push({ el: wrapper, dx: adjustedDx, dy: adjustedDy });
    }

    function showBlessings(blessings) {
      blessings.slice(0, blessingPositions.length).forEach((text, i) => {
        const pos = blessingPositions[i];
        const el = document.createElement('div');
        el.className = 'floating-blessing';
        el.textContent = text;
        Object.assign(el.style, pos);
        el.style.transform = `rotate(${pos.rotate})`;
        document.body.appendChild(el);
      });
    }

    function animate() {
      const w = window.innerWidth;
      const h = window.innerHeight;

      images.forEach((img, i) => {
        const el = img.el;
        const imgEl = el.querySelector('img');
        const scaleMatch = imgEl.style.transform.match(/scale\(([\d.]+)\)/);
        const scale = scaleMatch ? parseFloat(scaleMatch[1]) : 1;

        const width = el.offsetWidth * scale;
        const height = el.offsetHeight * scale;
        let x = parseFloat(el.style.left);
        let y = parseFloat(el.style.top);

        const nextX = x + img.dx;
        const nextY = y + img.dy;

        if (nextX < 0 || nextX + width > w) img.dx *= -1;
        if (nextY < 0 || nextY + height > h) img.dy *= -1;

        for (let j = 0; j < images.length; j++) {
          if (i !== j) {
            const other = images[j];
            const otherEl = other.el;
            const otherImg = otherEl.querySelector('img');
            const otherScaleMatch = otherImg.style.transform.match(/scale\(([\d.]+)\)/);
            const otherScale = otherScaleMatch ? parseFloat(otherScaleMatch[1]) : 1;

            const ox = parseFloat(otherEl.style.left);
            const oy = parseFloat(otherEl.style.top);
            const ow = otherEl.offsetWidth * otherScale;
            const oh = otherEl.offsetHeight * otherScale;

            const overlap =
              nextX < ox + ow &&
              nextX + width > ox &&
              nextY < oy + oh &&
              nextY + height > oy;

            if (overlap) {
              img.dx *= -1;
              img.dy *= -1;
              break;
            }
          }
        }

        el.style.left = (x + img.dx) + 'px';
        el.style.top  = (y + img.dy) + 'px';
      });

      requestAnimationFrame(animate);
    }

    window.addEventListener('message', event => {
      const data = event.data.images || [];

      // ניקוי הקודם
      document.querySelectorAll('.moving-img, .floating-blessing, .spinning-wrapper').forEach(el => {
        if (el.parentNode) el.parentNode.remove();
      });

      images.length = 0;

      const urls = data.map(obj => obj.url);
      const blessings = data.map(obj => obj.blessing).filter(b => b?.trim());

      urls.slice(0, 7).forEach((url, i) => createImage(url, imageSettings[i]));
      showBlessings(blessings);
      animate();
    });
  </script>
</body>
</html>
